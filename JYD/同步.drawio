<mxfile host="app.diagrams.net" modified="2023-07-19T08:30:15.772Z" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36" etag="1lECWnAYILqnoijrBCQg" version="21.6.2" type="device">
  <diagram name="第 1 页" id="dVBOyQNayiQEY88Q_D3k">
    <mxGraphModel dx="1001693" dy="935" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="999900" pageHeight="999900" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-1" value="生产者" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="70" y="230" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-2" value="消费者" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="870" y="230" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-3" value="服务端" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="490" y="70" width="110" height="380" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-4" value="" style="shape=flexArrow;endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-1" target="_n20_lQ6JL3QIpDgOMCV-3" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="680" y="360" as="sourcePoint" />
            <mxPoint x="730" y="310" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-6" value="发送数据" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="_n20_lQ6JL3QIpDgOMCV-4" vertex="1" connectable="0">
          <mxGeometry x="-0.2857" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-5" value="" style="shape=flexArrow;endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-3" target="_n20_lQ6JL3QIpDgOMCV-2" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="670" y="270" as="sourcePoint" />
            <mxPoint x="720" y="220" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-8" value="接收数据" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="_n20_lQ6JL3QIpDgOMCV-5" vertex="1" connectable="0">
          <mxGeometry x="-0.2" y="4" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-9" value="比如oms发送订单" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="70" y="160" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-10" value="wms接收订单" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="890" y="148" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-11" value="采用tcp/ip协议" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="240" y="330" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-12" value="mq发送" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="260" y="388" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-13" value="自定义socket协议" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="225" y="440" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-14" value="如果采用mq，有服务端&lt;br&gt;tcp/ip，无服务端" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="470" y="480" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-18" target="_n20_lQ6JL3QIpDgOMCV-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-21" value="mq下单同步给下游程序" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="_n20_lQ6JL3QIpDgOMCV-20" vertex="1" connectable="0">
          <mxGeometry x="-0.2427" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-18" value="客户端a" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="387.5" y="1560" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-19" value="客户端b" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="882.5" y="1560" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-22" target="_n20_lQ6JL3QIpDgOMCV-24" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="200" y="2285" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-25" value="点击下单" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="_n20_lQ6JL3QIpDgOMCV-23" vertex="1" connectable="0">
          <mxGeometry x="-0.2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-22" value="用户" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-30" y="2535" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-24" target="_n20_lQ6JL3QIpDgOMCV-27" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="530" y="2375" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-28" value="发送http请求下单" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="_n20_lQ6JL3QIpDgOMCV-26" vertex="1" connectable="0">
          <mxGeometry x="-0.2933" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-24" value="浏览器" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="150" y="2535" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-27" target="_n20_lQ6JL3QIpDgOMCV-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-33" value="发送消息给mq" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="_n20_lQ6JL3QIpDgOMCV-32" vertex="1" connectable="0">
          <mxGeometry x="-0.0286" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-27" value="oms系统" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="430" y="2520" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-29" value="1. http直接请求，需要自定义开发持久化，重试，回滚，提交，校验，事务。与4基本差不多。---封装http请求&lt;br style=&quot;font-size: 16px;&quot;&gt;2. 中间件mq负责解耦。封装底层mq同步。实现生产者或者消费者方法，自定义一些校验（参数校验，可以使用jsr303校验），去重（包装数据有一个校验唯一的方法）。使用springaop，自定义一个advisor，允许自定义多个处理器&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ---封装mq&lt;br style=&quot;font-size: 16px;&quot;&gt;3. 自己开发使用netty开发一套同步系统。需要在socket基础上进行封装持久化，重试，回滚，提交，校验，事务。 ------封装netty或者socket&lt;br style=&quot;font-size: 16px;&quot;&gt;4. 直接使用分布式事务，在1的基础上封装分布式事务。 或者&lt;br&gt;直接使用阿里巴巴的seate 地址：https://seata.io/zh-cn/docs/overview/what-is-seata.html（需要springcloud支持，需要微服务）最简单的方法。---- 需要有springcloud" style="whiteSpace=wrap;html=1;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="35" y="560" width="1100" height="160" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-30" value="mq" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="615" y="1430" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-100" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-31" target="_n20_lQ6JL3QIpDgOMCV-99" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-31" value="mq&lt;h2 data-darkreader-inline-bgcolor=&quot;&quot; style=&quot;margin: 10px 0px; padding: 0px; font-size: 21px; line-height: 1.5; font-family: Verdana, Arial, Helvetica, sans-serif; text-align: start; background-color: rgb(24, 26, 27); --darkreader-inline-bgcolor: #131516;&quot;&gt;削锋，解耦&lt;/h2&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="830" y="2355" width="120" height="390" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-104" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-35" target="_n20_lQ6JL3QIpDgOMCV-105" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="360" y="2730" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-108" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-35" target="_n20_lQ6JL3QIpDgOMCV-107" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-35" value="首先进行校验，幂等，自定义前处理器" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=15;" parent="1" vertex="1">
          <mxGeometry x="470" y="2615" width="280" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-37" value="消息" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="570" y="2540" width="60" height="50" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-50" value="生产者接口，该接口是spring创建的，无缝集成aop前处理器，后处理器。环绕通知。根据具体业务自定义添加" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="30" y="1720" width="600" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-67" value="produce&amp;lt;T&amp;gt;" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="260" y="1760" width="160" height="152" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-69" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="_n20_lQ6JL3QIpDgOMCV-67" vertex="1">
          <mxGeometry y="26" width="160" height="8" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-70" value="+ send(T): boolean" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="_n20_lQ6JL3QIpDgOMCV-67" vertex="1">
          <mxGeometry y="34" width="160" height="66" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-88" value="+ field: only&amp;lt;T&amp;gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="_n20_lQ6JL3QIpDgOMCV-67" vertex="1">
          <mxGeometry y="100" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-81" value="field: check &amp;lt;T&amp;gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="_n20_lQ6JL3QIpDgOMCV-67" vertex="1">
          <mxGeometry y="126" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-72" value="消费者，基本逻辑与生产者一致，参数校验，幂等校验。&lt;br&gt;每次监听到mq发送的消息，首先aop前处理器校验参数，幂等校验，再执行业务代码。最后ack" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
          <mxGeometry x="850" y="1765" width="520" height="40" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-73" value="consumer&amp;lt;T&amp;gt;" style="swimlane;fontStyle=1;align=center;verticalAlign=top;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1040" y="1810" width="160" height="142" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-74" value="" style="line;strokeWidth=1;fillColor=none;align=left;verticalAlign=middle;spacingTop=-1;spacingLeft=3;spacingRight=3;rotatable=0;labelPosition=right;points=[];portConstraint=eastwest;strokeColor=inherit;" parent="_n20_lQ6JL3QIpDgOMCV-73" vertex="1">
          <mxGeometry y="26" width="160" height="8" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-75" value="+ accept(T): boolean" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="_n20_lQ6JL3QIpDgOMCV-73" vertex="1">
          <mxGeometry y="34" width="160" height="56" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-140" value="field: check &amp;lt;T&amp;gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="_n20_lQ6JL3QIpDgOMCV-73" vertex="1">
          <mxGeometry y="90" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-139" value="+ field: only&amp;lt;T&amp;gt;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="_n20_lQ6JL3QIpDgOMCV-73" vertex="1">
          <mxGeometry y="116" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-76" value="check&amp;lt;T&amp;gt;" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="70" y="1970" width="140" height="52" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-77" value="+ valid(T) t" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="_n20_lQ6JL3QIpDgOMCV-76" vertex="1">
          <mxGeometry y="26" width="140" height="26" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-80" value="1" style="endArrow=open;html=1;endSize=12;startArrow=diamondThin;startSize=14;startFill=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=bottom;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-76" target="_n20_lQ6JL3QIpDgOMCV-81" edge="1">
          <mxGeometry x="-1" y="3" relative="1" as="geometry">
            <mxPoint x="260" y="1930" as="sourcePoint" />
            <mxPoint x="110" y="1770" as="targetPoint" />
            <Array as="points">
              <mxPoint x="140" y="1900" />
              <mxPoint x="190" y="1900" />
              <mxPoint x="190" y="1899" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-86" value="聚合校验方法,&lt;br&gt;具体代码实现使用aop代理方式。嵌套采用责任链模式。&lt;br&gt;该实体不需要一定聚合在produce中，aop无感，使用注解即可" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="_n20_lQ6JL3QIpDgOMCV-80" vertex="1" connectable="0">
          <mxGeometry x="-0.4153" y="2" relative="1" as="geometry">
            <mxPoint x="-88" y="-42" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-93" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-89" target="_n20_lQ6JL3QIpDgOMCV-88" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-95" value="与校验基本一致，只不过逻辑不同。&lt;br data-darkreader-inline-border=&quot;&quot; data-darkreader-inline-bgcolor=&quot;&quot; style=&quot;border-color: var(--darkreader-border--border-color); font-size: 12px; background-color: rgb(26, 28, 30); --darkreader-inline-bgcolor: #151718; --darkreader-inline-border: var(--darkreader-border--darkreader-border--border-color);&quot;&gt;&lt;span data-darkreader-inline-bgcolor=&quot;&quot; style=&quot;font-size: 12px; background-color: rgb(26, 28, 30); --darkreader-inline-bgcolor: #151718;&quot;&gt;甚至可以采用同一个接口check。为了防止唯一校验忘记写。&lt;br&gt;分开来，顶级接口可以使用同一个&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="_n20_lQ6JL3QIpDgOMCV-93" vertex="1" connectable="0">
          <mxGeometry x="-0.105" y="-3" relative="1" as="geometry">
            <mxPoint x="80" y="20" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-89" value="only" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="450" y="1954" width="140" height="104" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-90" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="_n20_lQ6JL3QIpDgOMCV-89" vertex="1">
          <mxGeometry y="26" width="140" height="26" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-91" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="_n20_lQ6JL3QIpDgOMCV-89" vertex="1">
          <mxGeometry y="52" width="140" height="26" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-92" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="_n20_lQ6JL3QIpDgOMCV-89" vertex="1">
          <mxGeometry y="78" width="140" height="26" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-96" value="这里校验最重要，假如是库存，一定要校验库存，只有库存有货的时候，才能进行创建订单。&lt;br style=&quot;font-size: 15px;&quot;&gt;如果在创建的时候，无法进行判断是否能够成功，只有消费者调用才能够感知是否成功，可以考虑加一个创建中字段&lt;br&gt;或者采用同步调用的方法直接判断是否成功。&lt;br&gt;&lt;font style=&quot;font-size: 15px;&quot;&gt;唯一校验就是判断该方法是否已经执行过了，一般在消费者进行判断，生产者允许发送多次同一条数据。&lt;br style=&quot;font-size: 15px;&quot;&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=15;" parent="1" vertex="1">
          <mxGeometry x="-220" y="2210" width="790" height="90" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-103" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-99" target="_n20_lQ6JL3QIpDgOMCV-102" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-131" value="保存db" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="_n20_lQ6JL3QIpDgOMCV-103" vertex="1" connectable="0">
          <mxGeometry x="-0.4111" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-114" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-99" target="_n20_lQ6JL3QIpDgOMCV-113" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-99" value="消费者" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1070" y="2520" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-102" value="db" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1370" y="2520" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-111" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-105" target="_n20_lQ6JL3QIpDgOMCV-110" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-105" value="校验成功消息给mq" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="250" y="2800" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-107" value="校验失败直接返回失败原因，并保存操作日志" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="550" y="2800" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-146" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-110" target="_n20_lQ6JL3QIpDgOMCV-147" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="310" y="3150" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-110" value="mq收到消息，保存操作日志。" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="250" y="2960" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-118" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-113" target="_n20_lQ6JL3QIpDgOMCV-117" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-113" value="监听队列，发现消息进行消费。必须手动进行ack。" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="990" y="2740" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-120" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-117" target="_n20_lQ6JL3QIpDgOMCV-119" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-122" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-117" target="_n20_lQ6JL3QIpDgOMCV-121" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-117" value="收到消息" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="990" y="2880" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-124" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-119" target="_n20_lQ6JL3QIpDgOMCV-123" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-119" value="处理成功" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="870" y="3020" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-150" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-121" target="_n20_lQ6JL3QIpDgOMCV-149" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-257" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-121" target="_n20_lQ6JL3QIpDgOMCV-256" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-121" value="处理失败，记录操作日志。重新丢回队列。等待下次再次进行消费" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1080" y="3020" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-127" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-123" target="_n20_lQ6JL3QIpDgOMCV-126" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-129" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-123" target="_n20_lQ6JL3QIpDgOMCV-128" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-123" value="手动ack" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="870" y="3160" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-148" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-126" target="_n20_lQ6JL3QIpDgOMCV-149" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="930" y="3520" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-126" value="ack成功，消息完美消费" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="870" y="3340" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-128" value="ack失败，但是执行成功了。mq会再次进行消费，每次消费者收到消息。会首先进入自定义的校验，重复校验里面。检测到重复数据直接ack。&lt;br&gt;" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="580" y="3250" width="230" height="100" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-133" value="与校验基本一致，只不过逻辑不同。&lt;br data-darkreader-inline-border=&quot;&quot; data-darkreader-inline-bgcolor=&quot;&quot; style=&quot;border-color: var(--darkreader-border--border-color); font-size: 12px; background-color: rgb(26, 28, 30); --darkreader-inline-bgcolor: #151718; --darkreader-inline-border: var(--darkreader-border--darkreader-border--border-color);&quot;&gt;&lt;span data-darkreader-inline-bgcolor=&quot;&quot; style=&quot;font-size: 12px; background-color: rgb(26, 28, 30); --darkreader-inline-bgcolor: #151718;&quot;&gt;甚至可以采用同一个接口check。为了防止唯一校验忘记写。&lt;br&gt;分开来，顶级接口可以使用同一个&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="1" vertex="1" connectable="0">
          <mxGeometry x="1410" y="2020" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-138" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-134" target="_n20_lQ6JL3QIpDgOMCV-73" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1230" y="1976" />
              <mxPoint x="1230" y="1940" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-134" value="only" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1260" y="2084" width="140" height="104" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-135" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="_n20_lQ6JL3QIpDgOMCV-134" vertex="1">
          <mxGeometry y="26" width="140" height="26" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-136" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="_n20_lQ6JL3QIpDgOMCV-134" vertex="1">
          <mxGeometry y="52" width="140" height="26" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-137" value="+ field: type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="_n20_lQ6JL3QIpDgOMCV-134" vertex="1">
          <mxGeometry y="78" width="140" height="26" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-141" value="check&amp;lt;T&amp;gt;" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=none;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="860" y="2130" width="140" height="52" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-142" value="+ valid(T) t" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;whiteSpace=wrap;html=1;" parent="_n20_lQ6JL3QIpDgOMCV-141" vertex="1">
          <mxGeometry y="26" width="140" height="26" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-143" value="1" style="endArrow=open;html=1;endSize=12;startArrow=diamondThin;startSize=14;startFill=1;edgeStyle=orthogonalEdgeStyle;align=left;verticalAlign=bottom;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-141" edge="1">
          <mxGeometry x="-1" y="3" relative="1" as="geometry">
            <mxPoint x="1035" y="1983" as="sourcePoint" />
            <mxPoint x="1035" y="1952" as="targetPoint" />
            <Array as="points">
              <mxPoint x="915" y="1953" />
              <mxPoint x="965" y="1953" />
              <mxPoint x="965" y="1952" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-144" value="聚合校验方法,&lt;br&gt;具体代码实现使用aop代理方式。嵌套采用责任链模式。&lt;br&gt;该实体不需要一定聚合在produce中，aop无感，使用注解即可" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="_n20_lQ6JL3QIpDgOMCV-143" vertex="1" connectable="0">
          <mxGeometry x="-0.4153" y="2" relative="1" as="geometry">
            <mxPoint x="-88" y="-42" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-147" value="后处理器" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="250" y="3160" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-149" value="后处理器" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="990" y="3670" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-151" value="http" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2430" y="20" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-152" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-154" target="_n20_lQ6JL3QIpDgOMCV-155" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-153" value="http发送下单同步给下游程序" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="_n20_lQ6JL3QIpDgOMCV-152" vertex="1" connectable="0">
          <mxGeometry x="-0.2427" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-154" value="客户端a" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2220" y="190" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-155" value="客户端b" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2715" y="190" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-156" value="封装openfei，以后无缝切换springcloud" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2430" y="340" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-203" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-191" target="_n20_lQ6JL3QIpDgOMCV-193" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-191" value="用户" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1570" y="680" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-192" value="发送http请求下单" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="1" vertex="1" connectable="0">
          <mxGeometry x="1931.8181818182347" y="708.0909090909095" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-204" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-193" target="_n20_lQ6JL3QIpDgOMCV-195" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-193" value="浏览器" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1750" y="680" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-205" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-195" target="_n20_lQ6JL3QIpDgOMCV-198" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-195" value="oms系统" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2030" y="680" width="110" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-196" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" target="_n20_lQ6JL3QIpDgOMCV-201" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2549.9999999998836" y="695" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-206" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-198" target="_n20_lQ6JL3QIpDgOMCV-201" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-207" value="发送http请求" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="_n20_lQ6JL3QIpDgOMCV-206" vertex="1" connectable="0">
          <mxGeometry x="-0.1082" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-227" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-198" target="_n20_lQ6JL3QIpDgOMCV-226" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-228" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-198" target="_n20_lQ6JL3QIpDgOMCV-195" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-229" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-198" target="_n20_lQ6JL3QIpDgOMCV-195" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-231" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-198" target="_n20_lQ6JL3QIpDgOMCV-195" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-233" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-198" target="_n20_lQ6JL3QIpDgOMCV-232" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-198" value="消息" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2230" y="685" width="60" height="50" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-199" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-201" target="_n20_lQ6JL3QIpDgOMCV-202" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-200" value="保存db" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="_n20_lQ6JL3QIpDgOMCV-199" vertex="1" connectable="0">
          <mxGeometry x="-0.4111" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-201" value="消费者" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="2500" y="680" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-202" value="db" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="2835" y="680" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-208" value="同步发送请求" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2201.25" y="460" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-209" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-210" target="_n20_lQ6JL3QIpDgOMCV-213" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-210" value="用户" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1587.5" y="1350" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-211" value="发送http请求下单" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="1" vertex="1" connectable="0">
          <mxGeometry x="1949.3181818182347" y="1378.0909090909095" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-212" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-213" target="_n20_lQ6JL3QIpDgOMCV-215" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-213" value="浏览器" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1767.5" y="1350" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-214" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-215" target="_n20_lQ6JL3QIpDgOMCV-219" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-215" value="oms系统" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2047.5" y="1350" width="110" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-216" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" target="_n20_lQ6JL3QIpDgOMCV-222" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2567.4999999998836" y="1365" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-217" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-219" target="_n20_lQ6JL3QIpDgOMCV-222" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-218" value="定时任务扫描待执行的任务，发送http请求" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="_n20_lQ6JL3QIpDgOMCV-217" vertex="1" connectable="0">
          <mxGeometry x="-0.1082" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-219" value="保存消息到db" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2187.5" y="1355" width="60" height="50" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-220" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-222" target="_n20_lQ6JL3QIpDgOMCV-223" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-221" value="保存db" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="_n20_lQ6JL3QIpDgOMCV-220" vertex="1" connectable="0">
          <mxGeometry x="-0.4111" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-248" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-222" target="_n20_lQ6JL3QIpDgOMCV-247" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-222" value="消费者" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="2517.5" y="1350" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-223" value="db" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="2852.5" y="1350" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-224" value="异步发送请求" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2307.5" y="1270" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-235" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-226" target="_n20_lQ6JL3QIpDgOMCV-234" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-237" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-226" target="_n20_lQ6JL3QIpDgOMCV-236" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-226" value="消息发送成功" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2270" y="860" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-232" value="消息发送失败，直接返回失败，保存日志" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2120" y="860" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-239" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-234" target="_n20_lQ6JL3QIpDgOMCV-238" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-234" value="消费者成功" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2200" y="990" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-236" value="消费者失败" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2350" y="990" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-238" value="继续执行，如果后面执行失败。还需要调用消费者进行回滚，回滚再当前线程执行不可靠，开线程池回滚不可靠。只能开一个定时任务去回滚消费者。就是异步发送请求" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2095" y="1110" width="332.5" height="70" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-241" value="" style="shape=flexArrow;endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-238" target="_n20_lQ6JL3QIpDgOMCV-224" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2030" y="1260" as="sourcePoint" />
            <mxPoint x="2080" y="1210" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-242" value="" style="endArrow=classic;startArrow=classic;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-243" target="_n20_lQ6JL3QIpDgOMCV-219" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="2220" y="1490" as="sourcePoint" />
            <mxPoint x="2320" y="1440" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-244" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-243" target="_n20_lQ6JL3QIpDgOMCV-245" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2217.4999999998836" y="1650" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-243" value="定时任务扫描需要执行的任务。" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2157.5" y="1480" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-246" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-245" target="_n20_lQ6JL3QIpDgOMCV-222" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-252" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-245" target="_n20_lQ6JL3QIpDgOMCV-251" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-245" value="发送请求" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2157.5" y="1600" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-250" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-247" target="_n20_lQ6JL3QIpDgOMCV-249" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-254" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="_n20_lQ6JL3QIpDgOMCV-247" target="_n20_lQ6JL3QIpDgOMCV-253" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-247" value="参数校验，幂等校验。。定时任务的消费者就是写一个controller。jsr303校验，幂等校验都是需要手动写一遍。或者采用注解方式拦截请求。" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="2486.25" y="1470" width="182.5" height="100" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-249" value="校验失败，返回错误" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="2430" y="1660" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-251" value="成功，失败，超时都需要版本+1，保存此次操作记录" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2157.5" y="1730" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-253" value="校验成功，直接失败" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="2610" y="1660" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-255" value="结果枚举&lt;br&gt;成功&lt;br&gt;失败&lt;br&gt;待重试" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="1610" y="1840" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-256" value="如果超过设置的最大重试次数。丢入死信队列，监听死信队列写入操作表并展现给用户" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="1330" y="3010" width="140" height="80" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-258" value="只需要一个操作记录表用来记录操作日志" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="620" y="1630" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_n20_lQ6JL3QIpDgOMCV-259" value="需要俩个表，任务表和操作记录表。每次操作记录操作日志表。" style="whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="2200" y="580" width="120" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
